package com.demo.dao;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import com.demo.beans.Employee;

public class EmpDaoImpl implements EmpDao {
	static Connection conn;
	static PreparedStatement insPst;   
	static PreparedStatement updatePst;
	static PreparedStatement selectAllPst;
	static CallableStatement showSalPst; 
	static PreparedStatement delPst;
	static PreparedStatement totalEmpSalPst; 
	static {
		try {
			conn=HBUtils.getMyConnection();
			insPst=conn.prepareStatement("insert into test values(?,?,?,?)");
			updatePst=conn.prepareStatement("update test set sal=? where eid=?");
			selectAllPst=conn.prepareStatement("select * from test");
			showSalPst=conn.prepareCall("call pro1(?,?)");
			delPst=conn.prepareStatement("delete from test where eid=?");
			totalEmpSalPst=conn.prepareStatement("select fun1()");
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
	@Override
	public boolean addEmp(Employee emp){
		try {
			insPst.setInt(1, emp.getEid());
			insPst.setString(2, emp.getEname());
			insPst.setDouble(3, emp.getSal());
			insPst.setDate(4, java.sql.Date.valueOf(emp.getHireDate()));
			int rowsUpdated = insPst.executeUpdate();
			return rowsUpdated>0;
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return false;
	}
	@Override
	public boolean updateSal(int eid,double sal) {
		try {
			updatePst.setDouble(1, sal);
			updatePst.setInt(2, eid);
			int rowsUpdates = updatePst.executeUpdate();
			return rowsUpdates>0;
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return false;
	}
	@Override
	public void showEmp() {
		try {
			ResultSet st=selectAllPst.executeQuery();
			System.out.println("==============================================================================");
			while(st.next()) {
				System.out.print("Emp Id : "+st.getInt(1)+"||");
				System.out.print("Emp Name : "+st.getString(2)+"||");
				System.out.print("Emp Sal : "+st.getDouble(3)+"||");
				System.out.print("Emp hire date : "+st.getDate(4)+"\n");
				System.out.println("==============================================================================");
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
	@Override
	public void showSalById(int eid) {
		try {
			showSalPst.setInt(1, eid);
			showSalPst.registerOutParameter(2, java.sql.Types.INTEGER);
			showSalPst.execute();
			int sal = showSalPst.getInt(2);
			if(sal>0)
				System.out.println("Emp Sal : "+sal);
			else
				System.out.println("Not Found");
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
	@Override
	public boolean deleteEmpById(int eid) {
		try {
			delPst.setInt(1, eid);
			int rowsUpdates = delPst.executeUpdate();
			return rowsUpdates>0;
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return false;
	}
	@Override
	public double TotalEmpSal() {
		try {
			totalEmpSalPst.executeQuery();
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
